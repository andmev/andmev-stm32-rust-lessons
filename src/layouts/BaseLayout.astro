---
import SEOHead from '@/components/SEOHead.astro';
import FontLoader from '@/components/FontLoader.astro';
import FooterNav from '@/components/FooterNav.astro';
import { getAvailableLanguages } from '@/utils/languages';
import { withBase } from '@/utils/url';
import { getPages } from '@/utils/collections';
import { ClientRouter } from 'astro:transitions';

interface Props {
  lang: string;
  title: string;
  description?: string;
  ogTitle?: string;
  ogDescription?: string;
  ogImage?: string;
  ogType?: 'website' | 'article';
  twitterCard?: 'summary' | 'summary_large_image';
  canonicalUrl?: string;
}

const {
  lang,
  title,
  description,
  ogTitle,
  ogDescription,
  ogImage,
  ogType = 'website',
  twitterCard = 'summary_large_image',
  canonicalUrl,
} = Astro.props;

const availableLanguages = await getAvailableLanguages();

const pages = (await getPages())
  .filter(({ id }) => id.startsWith(`${lang}/`))
  .sort((a, b) => a.data.order - b.data.order);

const site = Astro.site ? Astro.site.href : Astro.url.origin;
---

<html lang={lang} transition:animate="fade">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href={withBase('/favicon.svg')} />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />

    <FontLoader />

    <SEOHead
      title={title}
      description={description}
      lang={lang}
      ogTitle={ogTitle}
      ogDescription={ogDescription}
      ogImage={ogImage}
      ogType={ogType}
      twitterCard={twitterCard}
      canonicalUrl={canonicalUrl}
      site={site}
      currentUrl={Astro.url}
    />

    <ClientRouter />
  </head>
  <body class="bg-background text-foreground flex min-h-screen flex-col">
    <main class="flex-1" transition:name="main-content" transition:animate="slide">
      <slot />
    </main>

    <FooterNav
      lang={lang}
      pages={pages}
      availableLanguages={availableLanguages}
      currentPath={Astro.url.pathname}
      basePath={import.meta.env.BASE_URL.replace(/\/$/, '')}
    />
  </body>
</html>

<style is:global>
  @import '../styles/global.css';
</style>
